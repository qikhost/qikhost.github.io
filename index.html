<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pages</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg: #fafafa;
  --card: #ffffff;
  --text: #202124;
  --muted: #5f6368;
  --accent: #1a73e8;
  --chip: #e8eaed;
  --shadow: rgba(0,0,0,.12);
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #121212;
    --card: #1e1e1e;
    --text: #e8eaed;
    --muted: #9aa0a6;
    --accent: #8ab4f8;
    --chip: #2a2a2a;
    --shadow: rgba(0,0,0,.6);
  }
}

body {
  font-family: Roboto, Arial, sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 24px;
  color: var(--text);
}

.container {
  max-width: 900px;
  margin: auto;
}

h1, h2 {
  font-weight: 400;
}

.card {
  background: var(--card);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 24px;
  box-shadow: 0 2px 6px var(--shadow);
}

/* ---- CRYPTO ---- */
.crypto-tabs button {
  padding: 8px 12px;
  margin-right: 6px;
  border: none;
  border-radius: 6px;
  background: var(--chip);
  color: var(--text);
  cursor: pointer;
}

.crypto-tabs button.active {
  background: var(--accent);
  color: #000;
}

.crypto-value {
  margin-top: 12px;
  font-size: 14px;
  word-break: break-all;
  cursor: pointer;
}

.crypto-value:hover {
  text-decoration: underline;
}

.hint {
  font-size: 12px;
  color: var(--muted);
  margin-top: 4px;
}

canvas {
  margin-top: 16px;
  border-radius: 8px;
}

/* ---- SEARCH ---- */
input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 24px;
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--chip);
  border-radius: 6px;
}

/* ---- RESULTS ---- */
.result {
  margin-bottom: 24px;
}

.result a {
  font-size: 20px;
  color: var(--accent);
  text-decoration: none;
}

.result .url {
  color: #4caf50;
  font-size: 14px;
}

.result .desc {
  color: var(--muted);
}

/* ---- TOAST ---- */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: #323232;
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
  z-index: 9999;
}

.toast.show {
  opacity: 1;
}
</style>
</head>

<body>
<div class="container">

<h1>Pages</h1>

<!-- ================= CRYPTO WIDGET ================= -->
<div id="crypto-widget" class="card">

  <div class="crypto-tabs">
    <button id="tab-btc" onclick="setCrypto('btc')">BTC</button>
    <button id="tab-xmr" onclick="setCrypto('xmr')">XMR</button>
    <button id="tab-ln"  onclick="setCrypto('ln')">Lightning</button>
  </div>

  <div id="crypto-value" class="crypto-value" onclick="copyCrypto()"></div>
  <div id="crypto-hint" class="hint"></div>
  <canvas id="qr"></canvas>
</div>
<!-- ================================================== -->

<input id="search" placeholder="Search pages" oninput="renderResults()" />
<div id="results"></div>

</div>

<div id="toast" class="toast"></div>

<!-- ---------- CONFIG ---------- -->
<script>
const USERNAME = "qikhost";

const CRYPTO = {
  btc: "bc1q57u05eqz2mj6v0wr00p8wkrap3l003j9rwtyfy",
  xmr: "43Y38yeXY8m5sZLo1LezWwhH4SZkLeGSYMsn5JQbZoUUiwmj6sZqSVqENy4eSvZVM5hwbcudVLKAU1B8e1bTqrVgCfwoJLd",
  ln:  "mike@wallet.yakihonne.com"
};

let active = "btc";
let repos = [];
let lnInvoice = null;

function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 1200);
}

function drawQR(text) {
  const canvas = document.getElementById("qr");
  const ctx = canvas.getContext("2d");
  const img = new Image();
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
  };
  img.src =
    "https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=" +
    encodeURIComponent(text);
}

async function generateInvoice(amountSat = 1000) {
  try {
    const [name, domain] = CRYPTO.ln.split("@");
    const url = `https://${domain}/.well-known/lnurlp/${name}`;
    const meta = await fetch(url).then(r => r.json());

    const invoiceRes = await fetch(meta.callback + `?amount=${amountSat * 1000}`);
    const invoiceData = await invoiceRes.json();

    lnInvoice = invoiceData.pr;

    document.getElementById("crypto-value").innerText = lnInvoice;
    document.getElementById("crypto-hint").innerText =
      `Invoice for ${amountSat} sats — click to copy`;
    drawQR("lightning:" + lnInvoice);
  } catch(e) {
    console.error(e);
    showToast("Failed to generate invoice");
  }
}

function setCrypto(type) {
  active = type;
  lnInvoice = null;

  document.querySelectorAll(".crypto-tabs button")
    .forEach(b => b.classList.remove("active"));
  document.getElementById("tab-" + type).classList.add("active");

  const valueEl = document.getElementById("crypto-value");
  const hintEl = document.getElementById("crypto-hint");

  if (type === "ln") {
    valueEl.innerHTML = `
      ${CRYPTO.ln}<br><br>
      <button onclick="generateInvoice(1000)">1k sats</button>
      <button onclick="generateInvoice(5000)">5k sats</button>
      <button onclick="generateInvoice(10000)">10k sats</button>
    `;
    hintEl.innerText = "Generate a Lightning invoice";
    drawQR("lightning:" + CRYPTO.ln);
  } else {
    valueEl.innerText = CRYPTO[type];
    hintEl.innerText = "Click to copy";
    drawQR(CRYPTO[type]);
  }
}

function copyCrypto() {
  const text =
    active === "ln" && lnInvoice ? lnInvoice : CRYPTO[active];
  navigator.clipboard.writeText(text);
  showToast("Copied ✔");
}

setCrypto("btc");

/* ---------- FETCH & SEARCH ---------- */
fetch(`https://api.github.com/users/${USERNAME}/repos`)
  .then(r => r.json())
  .then(data => {
    repos = data.filter(r => r.description || r.homepage);
    renderResults();
  });

function renderResults() {
  const q = document.getElementById("search").value.toLowerCase();
  const out = document.getElementById("results");
  out.innerHTML = "";

  repos
    .filter(r =>
      (r.name + (r.description || "")).toLowerCase().includes(q)
    )
    .forEach(r => {
      // Always link to GitHub Pages version of the repo
      const url = `https://${USERNAME}.github.io/${r.name}/`;

      out.innerHTML += `
        <div class="result">
          <a href="${url}" target="_blank">${r.name}</a>
          <div class="url">${url}</div>
          <div class="desc">${r.description || ""}</div>
        </div>
      `;
    });
}
</script>

</body>
</html>

